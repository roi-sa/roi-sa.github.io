<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { 
            --primary: #27ae60; --nominal: #e67e22; --bg: #f1f5f9; 
            --text: #1e293b; --border: #e2e8f0; --loss: rgba(243, 156, 18, 0.15); --danger: #e74c3c;
            --info: #3498db; --secondary: #64748b;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: var(--text); }
        .card { background: #fff; width: 750px; max-width: 95%; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); display: grid; grid-template-columns: 310px 1fr; overflow: hidden; margin: 10px; position: relative; z-index: 1; }
        .inputs { padding: 12px; border-left: 1px solid var(--border); display: flex; flex-direction: column; gap: 6px; }
        h3 { margin: 0 0 4px 0; font-size: 15px; color: var(--primary); border-bottom: 2px solid var(--primary); padding-bottom: 2px; width: fit-content; }
        .input-group { display: flex; flex-direction: column; gap: 1px; position: relative; }
        label { font-size: 10.5px; font-weight: 600; color: #64748b; display: flex; align-items: center; gap: 5px; }
        .info-icon { cursor: help; color: var(--info); font-size: 13px; font-weight: bold; transition: 0.3s; display: inline-flex; align-items: center; justify-content: center; }
        .tooltip { position: relative; display: inline-flex; align-items: center; gap: 4px; }
        .tooltip .tooltiptext {
            visibility: hidden; width: 240px; background-color: #1e293b; color: #fff; 
            text-align: right; border-radius: 8px; padding: 10px; position: absolute; 
            z-index: 99; bottom: 130%; right: -10px; opacity: 0; transition: opacity 0.3s, transform 0.3s; 
            font-size: 10.5px; line-height: 1.5; box-shadow: 0 8px 15px rgba(0,0,0,0.2); 
            pointer-events: none; transform: translateY(10px);
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; transform: translateY(0); }
        input, select { width: 100%; padding: 0px 8px; border: 1px solid var(--border); border-radius: 5px; font-size: 12px; height: 24px; line-height: 24px; outline: none; transition: 0.2s; background: #fff; box-sizing: border-box; }
        .reset-btn { background: #fff; border: 1px solid var(--danger); color: var(--danger); border-radius: 5px; cursor: pointer; font-size: 10.5px; font-weight: bold; height: 24px; }
        .split-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; align-items: flex-end; }
        .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; align-items: flex-end; }
        .duration-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; margin-top: 1px; }
        .duration-btn { background: #f8fafc; border: 1px solid var(--border); padding: 4px; border-radius: 4px; cursor: pointer; font-size: 10px; font-weight: bold; color: #475569; }
        .duration-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .res-container { margin-top: 4px; display: flex; flex-direction: column; gap: 3px; }
        .res-row-inline { background: #f8fafc; padding: 2px 10px; border-radius: 5px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .res-row-inline span { font-size: 10px; font-weight: 600; }
        .res-row-inline .num-val { font-size: 11.5px; font-weight: 700; }
        .res-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 3px; }
        .res-item { background: #fff; padding: 4px 2px; border-radius: 5px; text-align: center; border: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .res-item.highlight { background: #f0fdf4; border-color: #bcf0da; }
        .res-label-box { display: flex; align-items: center; justify-content: center; gap: 4px; font-size: 9px; color: #64748b; font-weight: 600; margin-bottom: 1px; }
        .res-item strong { display: block; font-size: 12.5px; line-height: 1.2; }
        .export-btn { margin-top: 5px; background: var(--secondary); color: white; border: none; border-radius: 5px; padding: 6px; font-size: 11px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .currency-wrap { display: flex; flex-direction: row-reverse; align-items: center; gap: 4px; justify-content: center; }
        .num-val { direction: ltr; font-family: sans-serif; }
        .curr-sym { font-size: 10px; color: #64748b; font-weight: bold; }
        .chart-area { padding: 15px 10px 30px 25px; display: flex; flex-direction: column; justify-content: center; background: #fff; }
        svg { width: 100%; height: 280px; overflow: visible; }
        .grid-line { stroke: #f1f5f9; stroke-width: 1; }
        .axis-text { fill: #94a3b8; font-size: 10px; }
        #pathFill { fill: var(--loss); stroke: none; }
        #pathN { stroke: var(--nominal); stroke-width: 2.5; fill: none; } 
        #pathR { stroke: var(--primary); stroke-width: 2.5; fill: none; }
        .legend { display: flex; justify-content: center; gap: 15px; margin-top: 10px; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 10px; color: #64748b; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.8); display: none; justify-content: center; align-items: flex-start; z-index: 9999; overflow-y: auto; padding: 20px 0; backdrop-filter: blur(3px); }
        .modal-container { background: #fff; width: 930px; max-width: 95%; border-radius: 15px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); position: relative; overflow-x: auto; }
        .modal-toolbar { background: #f8fafc; padding: 15px 40px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; }
        .btn-download { background: var(--primary); color: white; border: none; padding: 8px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; }
        .btn-close { background: #e2e8f0; color: #475569; border: none; padding: 8px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 14px; }
        #pdf-template { width: 850px; background: #fff; padding: 40px; direction: rtl; margin: 0 auto; }
        .report-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid var(--primary); padding-bottom: 15px; margin-bottom: 20px; }
        .report-body { display: flex; gap: 20px; align-items: flex-start; }
        .report-right { width: 38%; }
        .report-left { width: 62%; }
        .summary-box { background: #f8fafc; border: 1px solid var(--border); border-radius: 10px; padding: 15px; margin-bottom: 15px; }
        .summary-title { color: var(--primary); border-bottom: 1px solid var(--border); margin-bottom: 10px; padding-bottom: 5px; font-size: 16px; font-weight: bold; }
        .summary-item { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 12.5px; border-bottom: 1px solid #f1f5f9; padding-bottom: 2px; }
        .report-table { width: 100%; border-collapse: collapse; font-size: 10px; table-layout: fixed; }
        .report-table th { background: var(--primary); color: #fff; padding: 6px 2px; text-align: center; border: 1px solid #eee; }
        .report-table td { padding: 3.5px 2px; border: 1px solid #eee; text-align: center; word-wrap: break-word; line-height: 12px; }
        .col-y { width: 7%; } .col-q { width: 14%; } .col-m { width: 14%; } .col-rn { width: 15%; } .col-bn { width: 17%; } .col-rr { width: 15%; } .col-bp { width: 18%; }
        .pdf-chart-container { text-align: center; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; background: white; margin-top: 10px; }
        .pdf-legend-fix { display: flex; justify-content: center; gap: 30px; margin-top: 15px; }
        .pdf-legend-fix div { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: bold; color: #000; }
        @media (max-width: 760px) { .card { grid-template-columns: 1fr; width: 100%; } .inputs { border-left: none; border-bottom: 1px solid var(--border); } }
    </style>
</head>
<body>
<div class="card" id="main-card">
    <div class="inputs">
        <h3>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
        <div class="split-row">
            <div class="input-group">
                <label>Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„ÙŠ (ï·¼)</label>
                <input type="number" id="init" placeholder="Ø§Ø¯Ø®Ù„ Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„" oninput="calc()">
            </div>
            <div class="input-group"><label style="opacity:0;">.</label><button class="reset-btn" onclick="resetForm()">Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button></div>
        </div>
        <div class="split-row">
            <div class="input-group">
                <label>Ø§Ù„Ø§Ø¯Ø®Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ (ï·¼)</label>
                <input type="number" id="m" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø¯Ø®Ø§Ø±" oninput="calc()">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© Ù„Ù„Ø§Ø¯Ø®Ø§Ø± % <div class="tooltip"><span class="info-icon">ğŸ›ˆ</span><span class="tooltiptext">Ù‡Ù†Ø§ ØªØ­Ø¯Ø¯ Ù†Ø³Ø¨Ø© Ø²ÙŠØ§Ø¯Ø© Ù…Ø§ ØªØ¯Ø®Ø±Ù‡ Ø³Ù†ÙˆÙŠØ§Ù‹Ø› ÙƒÙ…Ø«Ø§Ù„: Ø¥Ø°Ø§ Ø¨Ø¯Ø£Øª Ø§Ø¯Ø®Ø§Ø±Ùƒ Ø¨Ù€ 1000 Ø±ÙŠØ§Ù„ ÙˆØ§Ø®ØªØ±Øª Ø²ÙŠØ§Ø¯Ø© 10%ØŒ Ø³ÙŠØµØ¨Ø­ Ø§Ø¯Ø®Ø§Ø±Ùƒ 1100 Ø±ÙŠØ§Ù„ ÙÙŠ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ÙˆÙ‡ÙƒØ°Ø§.</span></div></label>
                <input type="number" id="stepUp" placeholder="Ù…Ø«Ø§Ù„: 10%" step="0.1" oninput="calc()">
            </div>
        </div>
        <div class="row-3">
            <div class="input-group"><label>Ø§Ù„Ø§Ø¯Ø®Ø§Ø± ÙƒÙ„:</label><select id="type" onchange="calc()"><option value="beginning">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø±</option><option value="end">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø±</option></select></div>
            <div class="input-group"><label>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</label><select id="compound" onchange="calc()"><option value="12">Ø´Ù‡Ø±ÙŠ</option><option value="4">Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ</option><option value="2" selected>Ù†ØµÙ Ø³Ù†ÙˆÙŠ</option><option value="1">Ø³Ù†ÙˆÙŠ</option></select></div>
            <div class="input-group"><label>Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø§Ø¯Ø®Ø§Ø±</label><input type="number" id="y" placeholder="Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø§Ø¯Ø®Ø§Ø±" max="50" oninput="calc()"></div>
        </div>
        <div class="split-row">
            <div class="input-group"><label>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø³Ù†ÙˆÙŠ % </label><input type="number" id="r" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø§Ø¦Ø¯" step="0.1" oninput="calc()"></div>
            <div class="input-group"><label>Ø§Ù„ØªØ¶Ø®Ù… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ø³Ù†ÙˆÙŠØ§Ù‹ %</label><input type="number" id="f" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„ØªØ¶Ø®Ù…" step="0.1" oninput="calc()"></div>
        </div>
        <div class="duration-buttons">
            <button class="duration-btn" id="btn-10" onclick="setYears(10, this)">10Ø³</button>
            <button class="duration-btn" id="btn-20" onclick="setYears(20, this)">20Ø³</button>
            <button class="duration-btn" id="btn-30" onclick="setYears(30, this)">30Ø³</button>
            <button class="duration-btn" id="btn-40" onclick="setYears(40, this)">40Ø³</button>
        </div>
        <div class="res-container">
            <div class="res-row-inline"><span>ØªØ¯Ø®Ø± Ø´Ù‡Ø±ÙŠØ§Ù‹ ÙÙŠ Ø¢Ø®Ø± Ø³Ù†Ø© Ù…Ù† Ø®Ø·Ø© Ø§Ø³ØªØ«Ù…Ø§Ø±Ùƒ:</span><div class="currency-wrap"><span class="curr-sym">ï·¼</span><strong class="num-val" id="lastYearPmt" style="color:#6366f1;">0</strong></div></div>
            <div class="res-row-inline" style="background:#eff6ff; border-color:#bfdbfe;"><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ø¯Ø®Ø§Ø±Ùƒ Ø¢Ø®Ø± Ø§Ù„Ù…Ø¯Ø© Ù‚Ø¨Ù„ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</span><div class="currency-wrap"><span class="curr-sym">ï·¼</span><strong class="num-val" id="totalSaved">0</strong></div></div>
            <div class="res-grid">
                <div class="res-item"><div class="res-label-box"><span>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø³Ù…ÙŠ</span><div class="tooltip"><span class="info-icon">ğŸ›ˆ</span><span class="tooltiptext">Ù‡Ùˆ ÙƒØ§Ù…Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„ØªÙŠ Ø§Ø³ØªØ«Ù…Ø±ØªÙ‡Ø§ Ù…Ø¶Ø§ÙØ§Ù‹ Ù„Ù‡Ø§ Ø£Ø±Ø¨Ø§Ø­Ùƒ Ø¨Ø¯ÙˆÙ† Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ¶Ø®Ù….</span></div></div><div class="currency-wrap"><span class="curr-sym">ï·¼</span><strong class="num-val" id="n">0</strong></div></div>
                <div class="res-item"><div class="res-label-box"><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø­</span><div class="tooltip"><span class="info-icon">ğŸ›ˆ</span><span class="tooltiptext">Ù‡Ùˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø°ÙŠ Ø­Ù‚Ù‚ØªÙ‡ Ø¨Ø¯ÙˆÙ† Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ¶Ø®Ù….</span></div></div><div class="currency-wrap"><span class="curr-sym">ï·¼</span><strong class="num-val" id="profitNominal" style="color:#2563eb;">0</strong></div></div>
            </div>
            <div class="res-grid">
                <div class="res-item highlight"><div class="res-label-box"><span>Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø´Ø±Ø§Ø¦ÙŠØ©</span><div class="tooltip"><span class="info-icon">ğŸ›ˆ</span><span class="tooltiptext">Ù‡Ùˆ ÙƒØ§Ù…Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„ØªÙŠ Ø§Ø³ØªØ«Ù…Ø±ØªÙ‡Ø§ Ù…Ø¶Ø§ÙØ§Ù‹ Ù„Ù‡Ø§ Ø£Ø±Ø¨Ø§Ø­Ùƒ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø£Ø«Ø± Ø§Ù„ØªØ¶Ø®Ù….</span></div></div><div class="currency-wrap"><span class="curr-sym">ï·¼</span><strong class="num-val" id="p" style="color:var(--primary);">0</strong></div></div>
                <div class="res-item highlight"><div class="res-label-box"><span>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ</span><div class="tooltip"><span class="info-icon">ğŸ›ˆ</span><span class="tooltiptext">Ù‡Ùˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø°ÙŠ Ø­Ù‚Ù‚ØªÙ‡ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø£Ø«Ø± Ø§Ù„ØªØ¶Ø®Ù….</span></div></div><div class="currency-wrap"><span class="curr-sym">ï·¼</span><strong class="num-val" id="profitReal" style="color:var(--primary);">0</strong></div></div>
            </div>
            <button class="export-btn" onclick="openReportModal()"><span>ğŸ“Š</span> Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        </div>
    </div>
    <div class="chart-area" id="chart-area">
        <svg id="svg" viewBox="-60 0 460 320"><g id="gLines"></g><path id="pathFill"/><path id="pathN"/><path id="pathR"/><g id="gLabels"></g></svg>
        <div class="legend" id="ui-legend">
            <div class="legend-item"><div style="width:12px;height:3px;background:var(--nominal);margin-left:6px;"></div> Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø³Ù…ÙŠ</div>
            <div class="legend-item"><div style="width:12px;height:3px;background:var(--primary);margin-left:6px;"></div> Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø´Ø±Ø§Ø¦ÙŠØ©</div>
        </div>
    </div>
</div>
<div class="modal-overlay" id="modalOverlay">
    <div class="modal-container">
        <div class="modal-toolbar"><h2 style="margin:0;font-size:18px;color:var(--text)">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h2><div style="display:flex;gap:10px;"><button class="btn-download" onclick="generatePDF()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù PDF</button><button class="btn-close" onclick="closeReportModal()">Ø¥ØºÙ„Ø§Ù‚</button></div></div>
        <div id="pdf-template">
            <div class="report-header"><h1 style="color:var(--primary);margin:0;font-size:24px;">ØªÙ‚Ø±ÙŠØ± Ø§Ø¯Ø®Ø§Ø± Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠ</h1><div style="text-align:left;font-size:14px;color:var(--secondary);">Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="pdf-date"></span></div></div>
            <div class="report-body">
                <div class="report-right">
                    <div class="summary-box">
                        <div class="summary-title">Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª</div>
                        <div class="summary-item">Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„: <strong id="pdf-init"></strong></div>
                        <div class="summary-item">Ø§Ù„Ø§Ø¯Ø®Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ: <strong id="pdf-m"></strong></div>
                        <div class="summary-item">Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© Ù„Ù„Ø§Ø¯Ø®Ø§Ø±: <strong id="pdf-stepup-val"></strong></div>
                        <div class="summary-item">Ø§Ù„Ù…Ø¯Ø©: <strong id="pdf-years"></strong></div>
                        <div class="summary-item">Ø§Ù„Ø¹Ø§Ø¦Ø¯: <strong id="pdf-r-nom"></strong></div>
                        <div class="summary-item">Ø§Ù„ØªØ¶Ø®Ù…: <strong id="pdf-f"></strong></div>
                    </div>
                    <div class="summary-box">
                        <div class="summary-title">Ù…Ù„Ø®Øµ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</div>
                        <div class="summary-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø³ØªØ«Ù…Ø±Ø©: <strong id="pdf-total-invested"></strong></div>
                        <div class="summary-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø±Ø¨Ø­ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©: <strong id="pdf-profit-nom-total"></strong></div>
                        <div class="summary-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ØµÙŠØ¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©: <strong id="pdf-n-final" style="color:var(--nominal);"></strong></div>
                        <div class="summary-item">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ: <strong id="pdf-avg-profit-nom"></strong></div>
                        <div class="summary-item">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ø£Ø³Ù…ÙŠ (NROR): <strong id="pdf-nror"></strong></div>
                        <div style="border-top:2px dashed #cbd5e1;margin:15px 0;"></div>
                        <div class="summary-title" style="color:var(--primary);">Ù…Ù„Ø®Øµ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø¨ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ¶Ø®Ù…</div>
                        <div class="summary-item">Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø´Ø±Ø§Ø¦ÙŠØ© Ù„Ø±ØµÙŠØ¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©: <strong id="pdf-p-final" style="color:var(--primary);"></strong></div>
                        <div class="summary-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±: <strong id="pdf-profit-real-total"></strong></div>
                        <div class="summary-item">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ: <strong id="pdf-avg-profit-real"></strong></div>
                        <div class="summary-item">Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (ROI): <strong id="pdf-roi-real-total"></strong></div>
                    </div>
                    <div class="pdf-chart-container"><div id="pdf-chart-copy"></div><div class="pdf-legend-fix"><div><span style="display:inline-block;width:15px;height:5px;background:#e67e22;margin-left:8px;"></span> Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø³Ù…ÙŠ</div><div><span style="display:inline-block;width:15px;height:5px;background:#27ae60;margin-left:8px;"></span> Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø´Ø±Ø§Ø¦ÙŠØ©</div></div></div>
                </div>
                <div class="report-left"><table class="report-table" id="pdf-table"><thead><tr><th class="col-y">Ø§Ù„Ø³Ù†Ø©</th><th class="col-q">Ø§Ù„Ù‚Ø³Ø·</th><th class="col-m">Ø§Ù„Ù…ÙˆØ¯Ø¹</th><th class="col-rn">Ø±Ø¨Ø­ Ø§Ø³Ù…ÙŠ</th><th class="col-bn">Ø±ØµÙŠØ¯ Ø§Ø³Ù…ÙŠ</th><th class="col-rr">Ø±Ø¨Ø­ Ø­Ù‚ÙŠÙ‚ÙŠ</th><th class="col-bp">Ù‚ÙˆØ© Ø´Ø±Ø§Ø¦ÙŠØ©</th></tr></thead><tbody></tbody></table></div>
            </div>
        </div>
    </div>
</div>
<script>
const CHART_HEIGHT = 280; const CHART_WIDTH = 390; let globalYearlyData = [];
function resetForm() { ['init','m','r','f','y','stepUp'].forEach(id=>document.getElementById(id).value=""); document.querySelectorAll('.duration-btn').forEach(b=>b.classList.remove('active')); calc(); }
function setYears(y, btn) { document.getElementById('y').value = y; document.querySelectorAll('.duration-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); calc(); }
function calc() {
    const p = parseFloat(document.getElementById('init').value) || 0;
    const pmtIn = parseFloat(document.getElementById('m').value) || 0;
    const rAnn = (parseFloat(document.getElementById('r').value) || 0) / 100;
    const fAnn = (parseFloat(document.getElementById('f').value) || 0) / 100;
    const stepUp = (parseFloat(document.getElementById('stepUp').value) || 0) / 100;
    let years = parseInt(document.getElementById('y').value) || 0;
    if (years > 50) { years = 50; document.getElementById('y').value = 50; }
    const typeVal = document.getElementById('type').value;
    const compoundVal = document.getElementById('compound').value;
    if (years === 0) { updateResults(0,0,0,0,0,0); drawChart([0],[0],1); return; }
    const n = parseInt(compoundVal); 
    const isBeginning = typeVal === 'beginning';
    const rReal = (1 + rAnn) / (1 + fAnn) - 1;
    const i_nom_m = Math.pow(1 + rAnn/n, n/12) - 1;
    const i_real_m = Math.pow(1 + rReal/n, n/12) - 1;
    let nominalData = [p]; let realData = [p]; globalYearlyData = []; 
    let curN = p; let curR = p; let curPmt = pmtIn; let totalInv = p;
    for (let y = 1; y <= years; y++) {
        for (let m = 1; m <= 12; m++) {
            if (isBeginning) { curN = (curN + curPmt) * (1 + i_nom_m); curR = (curR + curPmt) * (1 + i_real_m); }
            else { curN = curN * (1 + i_nom_m) + curPmt; curR = curR * (1 + i_real_m) + curPmt; }
            totalInv += curPmt;
        }
        nominalData.push(curN); realData.push(curR);
        globalYearlyData.push({ year: y, pmt: curPmt, totalSaved: totalInv, nomBal: curN, realBal: curR, nomProfit: curN - totalInv, realProfit: curR - totalInv });
        if (y < years) curPmt *= (1 + stepUp);
    }
    updateResults(totalInv, curN, curR, curN-totalInv, curR-totalInv, curPmt);
    drawChart(nominalData, realData, years);
}
function updateResults(saved, n, p, profN, profR, lastPmt) {
    const fmt = new Intl.NumberFormat('en-US');
    document.getElementById('totalSaved').innerText = fmt.format(Math.round(saved));
    document.getElementById('n').innerText = fmt.format(Math.round(n));
    document.getElementById('p').innerText = fmt.format(Math.round(p));
    document.getElementById('profitNominal').innerText = fmt.format(Math.round(profN));
    document.getElementById('profitReal').innerText = fmt.format(Math.round(profR));
    document.getElementById('lastYearPmt').innerText = fmt.format(Math.round(lastPmt));
}
function drawChart(nData, rData, years) {
    const maxVal = Math.max(...nData, 1000) * 1.1;
    const gLines = document.getElementById('gLines'); const gLabels = document.getElementById('gLabels');
    gLines.innerHTML = ''; gLabels.innerHTML = '';
    for (let i = 0; i <= 5; i++) {
        let y = CHART_HEIGHT - (i * CHART_HEIGHT / 5);
        let val = (maxVal * i / 5);
        let label = val >= 1000000 ? (val/1000000).toFixed(1) + 'M' : (val/1000).toFixed(0) + 'k';
        gLines.innerHTML += `<line x1="0" y1="${y}" x2="${CHART_WIDTH}" y2="${y}" class="grid-line" />`;
        gLines.innerHTML += `<text x="-15" y="${y + 3}" class="axis-text" text-anchor="end">${label}</text>`;
    }
    let dN = ""; let dR = "";
    nData.forEach((v, i) => {
        let x = (i / years) * CHART_WIDTH;
        let yN = CHART_HEIGHT - (v / maxVal * CHART_HEIGHT);
        let yR = CHART_HEIGHT - (rData[i] / maxVal * CHART_HEIGHT);
        dN += (i === 0 ? 'M' : 'L') + ` ${x} ${yN}`; dR += (i === 0 ? 'M' : 'L') + ` ${x} ${yR}`;
        if (i % Math.max(1, Math.ceil(years/5)) === 0 || i === years) gLabels.innerHTML += `<text x="${x}" y="${CHART_HEIGHT + 20}" class="axis-text" text-anchor="middle">${i}Ø³</text>`;
    });
    document.getElementById('pathN').setAttribute('d', dN); document.getElementById('pathR').setAttribute('d', dR);
    let dRevR = ""; for(let i = rData.length-1; i>=0; i--) { dRevR += ` L ${(i/years)*CHART_WIDTH} ${CHART_HEIGHT-(rData[i]/maxVal*CHART_HEIGHT)}`; }
    document.getElementById('pathFill').setAttribute('d', dN + dRevR + " Z");
}
function openReportModal() {
    const yearsInput = parseInt(document.getElementById('y').value); 
    if (!yearsInput || yearsInput === 0) { alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø£ÙˆÙ„Ø§Ù‹."); return; }
    fillReportData();
    const overlay = document.getElementById('modalOverlay');
    overlay.style.display = (window.innerWidth < 760) ? 'block' : 'flex'; // Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙ…Ø±ÙƒØ² ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„
    document.body.style.overflow = 'hidden';
}
function closeReportModal() { document.getElementById('modalOverlay').style.display = 'none'; document.body.style.overflow = 'auto'; }
function fillReportData() {
    const fmt = new Intl.NumberFormat('en-US');
    const yearsInput = parseInt(document.getElementById('y').value);
    document.getElementById('pdf-date').innerText = new Date().toLocaleDateString('ar-SA');
    document.getElementById('pdf-init').innerText = fmt.format(document.getElementById('init').value || 0) + " ï·¼";
    document.getElementById('pdf-m').innerText = fmt.format(document.getElementById('m').value || 0) + " ï·¼";
    document.getElementById('pdf-stepup-val').innerText = (document.getElementById('stepUp').value || 0) + "%";
    document.getElementById('pdf-years').innerText = yearsInput + " Ø³Ù†Ø©";
    document.getElementById('pdf-r-nom').innerText = (document.getElementById('r').value || 0) + "%";
    document.getElementById('pdf-f').innerText = (document.getElementById('f').value || 0) + "%";
    const savedNum = parseFloat(document.getElementById('totalSaved').innerText.replace(/,/g, ''));
    const nFinal = parseFloat(document.getElementById('n').innerText.replace(/,/g, ''));
    const pFinal = parseFloat(document.getElementById('p').innerText.replace(/,/g, ''));
    document.getElementById('pdf-total-invested').innerText = fmt.format(Math.round(savedNum)) + " ï·¼";
    document.getElementById('pdf-profit-nom-total').innerText = fmt.format(Math.round(nFinal - savedNum)) + " ï·¼";
    document.getElementById('pdf-n-final').innerText = fmt.format(Math.round(nFinal)) + " ï·¼";
    document.getElementById('pdf-avg-profit-nom').innerText = fmt.format(Math.round((nFinal - savedNum) / yearsInput)) + " ï·¼";
    document.getElementById('pdf-nror').innerText = ((nFinal / (savedNum || 1) - 1) * 100).toFixed(1) + "%";
    document.getElementById('pdf-p-final').innerText = fmt.format(Math.round(pFinal)) + " ï·¼";
    document.getElementById('pdf-profit-real-total').innerText = fmt.format(Math.round(pFinal - savedNum)) + " ï·¼";
    document.getElementById('pdf-avg-profit-real').innerText = fmt.format(Math.round((pFinal - savedNum) / yearsInput)) + " ï·¼";
    document.getElementById('pdf-roi-real-total').innerText = ((pFinal / (savedNum || 1) - 1) * 100).toFixed(1) + "%";
    document.querySelector('#pdf-table tbody').innerHTML = globalYearlyData.map(d => `<tr><td>${d.year}</td><td>${fmt.format(Math.round(d.pmt))}</td><td>${fmt.format(Math.round(d.totalSaved))}</td><td>${fmt.format(Math.round(d.nomProfit))}</td><td>${fmt.format(Math.round(d.nomBal))}</td><td>${fmt.format(Math.round(d.realProfit))}</td><td>${fmt.format(Math.round(d.realBal))}</td></tr>`).join('');
    const chartBox = document.getElementById('pdf-chart-copy'); chartBox.innerHTML = '';
    const svgClone = document.getElementById('svg').cloneNode(true); svgClone.setAttribute("width", "280"); chartBox.appendChild(svgClone);
}
async function generatePDF() {
    const { jsPDF } = window.jspdf;
    const canvas = await html2canvas(document.getElementById('pdf-template'), { scale: 2, useCORS: true, backgroundColor: '#ffffff' });
    const pdf = new jsPDF('p', 'mm', 'a4');
    pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 210, (canvas.height * 210) / canvas.width);
    pdf.save('Investment_Report.pdf');
}
window.onload = () => {
    document.getElementById('init').value = 10000; document.getElementById('m').value = 1000; document.getElementById('stepUp').value = 5;
    document.getElementById('y').value = 10; document.getElementById('r').value = 6; document.getElementById('f').value = 2.5;
    document.getElementById('type').value = 'beginning'; document.getElementById('compound').value = '2';
    const btn10 = document.getElementById('btn-10'); if(btn10) btn10.classList.add('active'); calc();
};
</script>
</body>
</html>

