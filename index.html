<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حاسبة الاستثمار الاحترافية - نسخة النصوص الإرشادية</title>
    <style>
        :root { 
            --primary: #27ae60; 
            --nominal: #e67e22; 
            --bg: #f1f5f9; 
            --text: #1e293b; 
            --border: #e2e8f0; 
            --loss: rgba(243, 156, 18, 0.15); 
            --danger: #e74c3c;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: var(--text); }
        .card { background: #fff; width: 750px; max-width: 95%; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); display: grid; grid-template-columns: 310px 1fr; overflow: hidden; margin: 20px; }
        .inputs { padding: 14px; border-left: 1px solid var(--border); display: flex; flex-direction: column; gap: 7px; }
        h3 { margin: 0 0 4px 0; font-size: 15px; color: var(--primary); border-bottom: 2px solid var(--primary); padding-bottom: 2px; width: fit-content; }
        .input-group { display: flex; flex-direction: column; gap: 1px; }
        label { font-size: 10.5px; font-weight: 600; color: #64748b; }
        input, select { width: 100%; padding: 0px 10px; border: 1px solid var(--border); border-radius: 5px; font-size: 12.5px; height: 26px; line-height: 26px; outline: none; transition: 0.2s; background: #fff; box-sizing: border-box; }
        input:focus, select:focus { border-color: var(--primary); }
        
        /* تنسيق النصوص الإرشادية (Placeholder) */
        input::placeholder { color: #cbd5e1; font-size: 11px; }

        .reset-btn { background: #fff; border: 1px solid var(--danger); color: var(--danger); padding: 0; border-radius: 5px; cursor: pointer; font-size: 11px; font-weight: bold; height: 26px; transition: 0.2s; margin-top: auto; }
        .reset-btn:hover { background: var(--danger); color: #fff; }

        .split-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .duration-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; margin-top: 2px; }
        .duration-btn { background: #f8fafc; border: 1px solid var(--border); padding: 5px; border-radius: 4px; cursor: pointer; font-size: 10.5px; font-weight: bold; color: #475569; }
        .duration-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .res-container { margin-top: 6px; display: flex; flex-direction: column; gap: 4px; }
        .currency-wrap { display: flex; flex-direction: row-reverse; align-items: center; gap: 5px; justify-content: center; }
        .num-val { direction: ltr; font-family: sans-serif; }
        .curr-sym { font-size: 11px; color: #64748b; font-weight: bold; }
        
        .res-row-inline { background: #f8fafc; padding: 6px 10px; border-radius: 6px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .res-row-inline span { font-size: 11px; font-weight: 600; }
        .res-row-inline strong { font-size: 14px; }
        
        .res-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
        .res-item { background: #fff; padding: 6px 4px; border-radius: 6px; text-align: center; border: 1px solid var(--border); }
        .res-item.highlight { background: #f0fdf4; border-color: #bcf0da; }
        .res-item span { display: block; font-size: 9.5px; color: #64748b; font-weight: 600; margin-bottom: 2px; }
        .res-item strong { display: block; font-size: 13.5px; }

        .chart-area { padding: 15px 10px 30px 25px; display: flex; flex-direction: column; justify-content: center; background: #fff; }
        svg { width: 100%; height: 280px; overflow: visible; }
        .grid-line { stroke: #f1f5f9; stroke-width: 1; }
        .axis-text { fill: #94a3b8; font-size: 10px; }
        #pathFill { fill: var(--loss); stroke: none; }
        #pathN { stroke: var(--nominal); stroke-width: 2.5; fill: none; } 
        #pathR { stroke: var(--primary); stroke-width: 2.5; fill: none; }
        
        .legend { display: flex; justify-content: center; gap: 15px; margin-top: 10px; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 10px; color: #64748b; }
        @media (max-width: 760px) { .card { grid-template-columns: 1fr; width: 100%; } .inputs { border-left: none; border-bottom: 1px solid var(--border); } }
    </style>
</head>
<body>

<div class="card">
    <div class="inputs">
        <h3>المعطيات المالية</h3>
        
        <div class="split-row">
            <div class="input-group">
                <label>رأس المال الأولي (﷼)</label>
                <input type="number" id="init" placeholder="ادخل رأس المال" oninput="calc()">
            </div>
            <div class="input-group">
                <label style="opacity: 0;">.</label>
                <button class="reset-btn" onclick="resetForm()">مسح النموذج</button>
            </div>
        </div>

        <div class="split-row">
            <div class="input-group">
                <label>الادخار الشهري (﷼)</label>
                <input type="number" id="m" placeholder="ادخل الادخار" oninput="calc()">
            </div>
            <div class="input-group">
                <label>الادخار كل:</label>
                <select id="type" onchange="calc()">
                    <option value="" disabled selected>اختر...</option>
                    <option value="beginning">بداية الشهر</option>
                    <option value="end">نهاية الشهر</option>
                </select>
            </div>
        </div>
        <div class="split-row">
            <div class="input-group">
                <label>العائد السنوي %</label>
                <input type="number" id="r" placeholder="ادخل العائد" step="0.1" oninput="calc()">
            </div>
            <div class="input-group">
                <label>توزيع الأرباح</label>
                <select id="compound" onchange="calc()">
                    <option value="" disabled selected>اختر...</option>
                    <option value="12">شهري</option>
                    <option value="4">ربع سنوي</option>
                    <option value="2">نصف سنوي</option>
                    <option value="1">سنوي</option>
                </select>
            </div>
        </div>
        <div class="split-row">
            <div class="input-group">
                <label>التضخم %</label>
                <input type="number" id="f" placeholder="ادخل التضخم" step="0.1" oninput="calc()">
            </div>
            <div class="input-group">
                <label>السنوات</label>
                <input type="number" id="y" placeholder="ادخل السنوات" oninput="calc()">
            </div>
        </div>
        <div class="duration-buttons">
            <button class="duration-btn" onclick="setYears(10, this)">10س</button>
            <button class="duration-btn" onclick="setYears(20, this)">20س</button>
            <button class="duration-btn" onclick="setYears(30, this)">30س</button>
            <button class="duration-btn" onclick="setYears(40, this)">40س</button>
        </div>
        <div class="res-container">
            <div class="res-row-inline">
                <span>إجمالي مبلغ الادخار:</span>
                <div class="currency-wrap">
                    <span class="curr-sym">﷼</span>
                    <strong class="num-val" id="totalSaved">0</strong>
                </div>
            </div>
            <div class="res-grid">
                <div class="res-item">
                    <span>الرصيد الاسمي</span>
                    <div class="currency-wrap"><span class="curr-sym">﷼</span><strong class="num-val" id="n">0</strong></div>
                </div>
                <div class="res-item">
                    <span>إجمالي الربح</span>
                    <div class="currency-wrap"><span class="curr-sym">﷼</span><strong class="num-val" id="profitNominal" style="color: #2563eb;">0</strong></div>
                </div>
            </div>
            <div class="res-grid">
                <div class="res-item highlight">
                    <span>القوة الشرائية</span>
                    <div class="currency-wrap"><span class="curr-sym">﷼</span><strong class="num-val" id="p" style="color: var(--primary);">0</strong></div>
                </div>
                <div class="res-item highlight">
                    <span>الربح الحقيقي</span>
                    <div class="currency-wrap"><span class="curr-sym">﷼</span><strong class="num-val" id="profitReal" style="color: var(--primary);">0</strong></div>
                </div>
            </div>
        </div>
    </div>
    <div class="chart-area">
        <svg id="svg" viewBox="-60 0 460 320">
             <g id="gLines"></g>
            <path id="pathFill" /> 
            <path id="pathN" /> 
            <path id="pathR" /> 
            <g id="gLabels"></g>
        </svg>
        <div class="legend">
            <div class="legend-item"><div style="width:12px;height:3px;background:var(--nominal);border-radius:2px;margin-left:6px;"></div> الرصيد الاسمي</div>
            <div class="legend-item"><div style="width:12px;height:3px;background:var(--primary);border-radius:2px;margin-left:6px;"></div> القوة الشرائية</div>
        </div>
    </div>
</div>

<script>
const CHART_HEIGHT = 280; 
const CHART_WIDTH = 390; 

function resetForm() {
    document.getElementById('init').value = "";
    document.getElementById('m').value = "";
    document.getElementById('r').value = "";
    document.getElementById('f').value = "";
    document.getElementById('y').value = "";
    document.getElementById('type').selectedIndex = 0;
    document.getElementById('compound').selectedIndex = 0;
    document.querySelectorAll('.duration-btn').forEach(b => b.classList.remove('active'));
    calc();
}

function setYears(y, btn) {
    document.getElementById('y').value = y;
    document.querySelectorAll('.duration-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active'); 
    calc();
}

function calc() {
    const p = parseFloat(document.getElementById('init').value) || 0;
    const pmt = parseFloat(document.getElementById('m').value) || 0;
    const rAnn = (parseFloat(document.getElementById('r').value) || 0) / 100;
    const fAnn = (parseFloat(document.getElementById('f').value) || 0) / 100;
    const years = parseInt(document.getElementById('y').value) || 0;
    const typeVal = document.getElementById('type').value;
    const compoundVal = document.getElementById('compound').value;
    
    if (!typeVal || !compoundVal || years === 0) {
        updateResults(0, 0, 0, 0, 0);
        drawChart([0], [0], 1);
        return;
    }

    const n = parseInt(compoundVal);
    const isBeginning = typeVal === 'beginning';
    let nominalData = []; let realData = [];
    
    const i_eff_monthly = Math.pow(1 + rAnn/n, n/12) - 1;
    const rReal = (1 + rAnn) / (1 + fAnn) - 1;
    const i_real_monthly = Math.pow(1 + rReal/n, n/12) - 1; 

    for (let y = 0; y <= years; y++) {
        const months = y * 12;
        let fv_pmt_nom = 0;
        if (Math.abs(i_eff_monthly) > 1e-10) {
            fv_pmt_nom = pmt * ((Math.pow(1 + i_eff_monthly, months) - 1) / i_eff_monthly);
            if (isBeginning) fv_pmt_nom *= (1 + i_eff_monthly);
        } else { fv_pmt_nom = pmt * months; }
        const fv_p_nom = p * Math.pow(1 + rAnn/n, n * y);
        nominalData.push(fv_p_nom + fv_pmt_nom);

        let fv_pmt_real = 0;
        if (Math.abs(i_real_monthly) > 1e-10) { 
            fv_pmt_real = pmt * ((Math.pow(1 + i_real_monthly, months) - 1) / i_real_monthly);
            if (isBeginning) fv_pmt_real *= (1 + i_real_monthly);
        } else { fv_pmt_real = pmt * months; }
        const fv_p_real = p * Math.pow(1 + rReal/n, n * y);
        realData.push(fv_p_real + fv_pmt_real);
    }
        
    const lastN = nominalData[years]; 
    const lastR = realData[years];
    const totalInv = p + (pmt * 12 * years);
    updateResults(totalInv, lastN, lastR, lastN - totalInv, lastR - totalInv);
    drawChart(nominalData, realData, years);
}

function updateResults(saved, n, p, profN, profR) {
    const fmt = new Intl.NumberFormat('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
    document.getElementById('totalSaved').innerText = fmt.format(Math.round(saved));
    document.getElementById('n').innerText = fmt.format(n);
    document.getElementById('p').innerText = fmt.format(p);
    document.getElementById('profitNominal').innerText = fmt.format(profN);
    document.getElementById('profitReal').innerText = fmt.format(profR);
}

function drawChart(nData, rData, years) {
    const maxVal = Math.max(...nData, 1000) * 1.1;
    const gLines = document.getElementById('gLines'); 
    const gLabels = document.getElementById('gLabels');
    gLines.innerHTML = ''; gLabels.innerHTML = '';
        
    for (let i = 0; i <= 5; i++) {
        let y = CHART_HEIGHT - (i * CHART_HEIGHT / 5);
        let val = (maxVal * i / 5);
        let label = val >= 1000000 ? (val/1000000).toFixed(1) + 'M' : (val/1000).toFixed(0) + 'k';
        gLines.innerHTML += `<line x1="0" y1="${y}" x2="${CHART_WIDTH}" y2="${y}" class="grid-line" />`;
        gLines.innerHTML += `<text x="-15" y="${y + 3}" class="axis-text" text-anchor="end">${label}</text>`;
    }

    let dN = ""; let dR = "";
    nData.forEach((v, i) => {
        let x = (i / years) * CHART_WIDTH;
        let yN = CHART_HEIGHT - (v / maxVal * CHART_HEIGHT);
        let yR = CHART_HEIGHT - (rData[i] / maxVal * CHART_HEIGHT);
        dN += (i === 0 ? 'M' : 'L') + ` ${x} ${yN}`;
        dR += (i === 0 ? 'M' : 'L') + ` ${x} ${yR}`;
        const step = Math.max(1, Math.ceil(years / 5));
        if (i % step === 0 || i === years) {
            gLabels.innerHTML += `<text x="${x}" y="${CHART_HEIGHT + 20}" class="axis-text" text-anchor="middle">${i}س</text>`;
        }
    });

    let dReverseR = "";
    for(let i = rData.length - 1; i >= 0; i--) {
        let x = (i / years) * CHART_WIDTH;
        let yR = CHART_HEIGHT - (rData[i] / maxVal * CHART_HEIGHT);
        dReverseR += ` L ${x} ${yR}`;
    }
    let dFill = dN + dReverseR + " Z";
    document.getElementById('pathN').setAttribute('d', dN);
    document.getElementById('pathR').setAttribute('d', dR);
    document.getElementById('pathFill').setAttribute('d', dFill);
}
window.onload = resetForm;
</script>
</body>
</html>
